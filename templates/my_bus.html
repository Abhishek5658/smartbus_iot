<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Bus</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 {
      margin-bottom: 10px;
    }
    #busInfo {
      margin-bottom: 20px;
    }

    /* Cartoon-style bus progress bar */
    .road-container {
      position: relative;
      background: #ddd;
      height: 60px;
      margin-bottom: 20px;
      border-radius: 30px;
    }
    .start-stop, .end-stop {
      position: absolute;
      top: 18px;
      font-weight: bold;
    }
    .start-stop {
      left: 10px;
    }
    .end-stop {
      right: 10px;
    }
    .bus-icon {
      position: absolute;
      top: 10px;
      width: 40px;
      transition: left 0.5s ease;
    }

    #map {
      height: 400px;
      width: 100%;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>üéØ My Bus Tracker</h2>

  <div id="busInfo">
    <p>üõ£Ô∏è <strong>Route:</strong> <span id="routeDisplay">---</span></p>
    <p>üöå <strong>Bus No:</strong> <span id="busDisplay">---</span></p>
  </div>

  <!-- üõ£Ô∏è Cartoon-style Road with Bus -->
  <div class="road-container" id="roadBar">
    <span class="start-stop">Start</span>
    <img src="https://th.bing.com/th/id/OIP.hP6LOMlC3Z44yuaULWTI6AHaHa?w=250&h=250&c=8&rs=1&qlt=90&o=6&dpr=1.4&pid=3.1&rm=2" class="bus-icon" id="busIcon" />







    <span class="end-stop">End</span>
  </div>

  <!-- üó∫Ô∏è Map Section -->
  <div id="map"></div>

  <!-- JS -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    let busIconEl = document.getElementById("busIcon");

    function moveBus(percent) {
      const roadWidth = document.getElementById("roadBar").offsetWidth - 50;
      const position = (percent / 100) * roadWidth;
      busIconEl.style.left = `${position}px`;
    }

    // Simulate bus moving over time (can replace with real API data)
    let progress = 0;
    setInterval(() => {
      if (progress < 100) {
        progress += 5;
        moveBus(progress);
      }
    }, 1000);

    // Load selected route/bus from storage
    window.onload = () => {
      const route = localStorage.getItem("selectedRoute") || "---";
      const bus = localStorage.getItem("selectedBus") || "---";
      document.getElementById("routeDisplay").textContent = route;
      document.getElementById("busDisplay").textContent = bus;

      initMap(); // start map after loading
    };

    // Leaflet map & alert marker
    let map, alertMarker = null, alertLocation = null;

    function initMap() {
      map = L.map('map').setView([12.9716, 77.5946], 13); // default to Bangalore

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data ¬© OpenStreetMap contributors',
      }).addTo(map);

      // Show current user location
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        map.setView([lat, lng], 15);

        const userIcon = L.icon({
          iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
          iconSize: [30, 30],
          iconAnchor: [15, 30]
        });

        L.marker([lat, lng], { icon: userIcon }).addTo(map).bindPopup("üìç You are here");
      });

      // Click to set alert
      map.on("click", function (e) {
        if (alertMarker) map.removeLayer(alertMarker);
        alertLocation = [e.latlng.lat, e.latlng.lng];
        alertMarker = L.marker(alertLocation).addTo(map).bindPopup("üìç Alert set here").openPopup();
        alert("‚úÖ Alert set at:\nLat: " + alertLocation[0].toFixed(5) + "\nLng: " + alertLocation[1].toFixed(5));
      });
    }
  </script>
</body>
</html>
